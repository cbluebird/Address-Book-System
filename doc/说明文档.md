# Address-Book-System

## 简介

c++大一下课设

简单实现了一个数据库的基础泛型模板框架，做到了开箱即用的效果

并通过通讯录这个案例展示了它的搭建与相关api的使用

## 特色

* 自己搭建了一个简单的数据库底层框架，提供了简单的api
* 在代码编写上，尽量做到了代码的解耦，按照最小功能原则进行分拆
* 使用了lambda表达式，使得接口可以更范型一些
* 使用了正则表达式来进行判断字符的合法性
* 使用了shared_timed_lock来管理并发线程的读写
* 内存管理模仿了go语言的cache，由一个统一的内存池来管理
* 提供了行锁、表锁、共享锁、互斥锁来保证数据操作的安全性
* 模仿的InnoDB的结构B+Tree，作了主键索引，优化查询速度
* 编写了相应的迭代器，并重载了相应的运算符来提供对于挂载页的快速访问
* 最终封装到了table一级，基本可以开箱即用
* 在缓存池中使用了lru算法，方便回收可利用的空间，起到了一定gc的作用

## 待优化的方面

* 在main函数中并发编程
* 优化main复杂度
* 索引方面的优化，对于联合索引和唯一索引的支持
* 在读写锁上的进一步优化，将功能集成化
* 比较遗憾的点在于没有使用json做存储结构，在txt下，看不出缓存池和B+Tree
  的优点，但是在json存储下，读写速率和缓存占用会得到极大的提升，可以使得一个page_id对应多个叶子结点，通过lru算法降低读取的内存消耗
* 使用json作程序运行中暂时存储，都针对json操作，这样效率高，在结束程序的时候写入txt，并删除json，在每一次程序如果有json则从json读取，没有则创建

## 核心类的设计：

### Page

设计：主要用于在程序中存储叶子节点的数据，并通过buffer_pool_manager做统一管理。
注意，page和叶子结点并不是一对一的关系，一个page可以对应多个叶子结点，而这个关系是通过lru算法来决定的，
lru会选择最少使用的page来存储

主要功能：让数据和数据结构做一个解耦，以page作为储存单位，便于管理

结构：
* pin_count:有多少进程在使用
* page_id:在buffer_pool_manager中的编号
* unordered_map<key,value> *data:关系型map，加快存储和读写速度

### BufferPoolManager

设计：管理page页面，提供了缓存功能，介于磁盘永久化存储和程序之间。在内部实现了LRU_replacer，以此来管理page对应的node节点

主要功能：缓存磁盘中的数据，降低读写带来的开销时间，使用LRU算法，每一次都是选取最少用的page，以此来达到存储的相对合理性

结构：
* unordered_mao<page_id,frame_id>page_table:主要功能是从page_id映射到缓存的偏移位置
* pages[]：使用数组缓存页面，降低储存和读写时所需要的开销
* latch：异步锁，保证并发的安全性
* capcity：最大容量
* LRU_replacer：一个简单的lru算法的实现，直接实现在了buffer_pool_manager中，便于操作

### Node

设计：B+Tree的节点，分为内部节点和叶节点，内部存了对应的key，B+Tree的主要特点为将多个key集成到一个node上

功能：B+Tree的主要组成部分

结构：略

### BPlusTree

设计：核心数据结构，本质上是一棵多路复用的平衡树，保证了节点都在同一高度上，叶子结点构成了一个双向链表，可以便利的操作

功能：核心数据结构提供了基础的增删改查功能

结构：略

### Iterator

设计：针对B+Tree叶子结点的一个迭代器，叶子结点构成了一个双向链表，重载了迭代器的运算符来对叶子节点简单的操作

功能：对于叶子结点的操作提供便利的操作，简化了代码

结构：
* start：node的开始节点
* cur：当前node节点
* end：结束node节点
* int_cur：在当前节点内部的位置

### File

设计：文件管理，在本地磁盘上做持久化存储

功能：选择了txt作为存储格式，提供了便捷的操作

结构：

* path：存储路径
* type：存储格式

### Table

设计：将B+Tree和File文件进行了整合，并内置了读写锁，避免了高并发下的数据库可能出现的问题

功能：提供了增删改查功能，每一个操作都有对应的读写锁来保护线程

结构：

* shared_timed_lock
* file
* BPlusTree

### 一些说明

由于是范型框架所以针对主键的选择我们提供的是通过lambda表达式来选择主键

查找指定的条件也是一样的，通过lambda表达式来进行判断

## 参考文章

[随笔分类 -  CMU15-445（cmu数据库课程）Lab](https://www.cnblogs.com/JayL-zxl/category/1919605.html)

[Address-Book-System](https://github.com/Patrick-Star-CN/Address-Book-System)